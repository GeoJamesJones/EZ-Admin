<!--{% extends 'bootstrap/base.html' %}-->

{% block head %}
  
      <!-- /.calcite-panels -->
    
      <script type="text/javascript">
        var dojoConfig = {
          packages: [{
            name: "bootstrap",
            location: "http://localhost/arcgis_js_api/library/4.11/dojo/Calcite-Maps/dist/vendor/dojo-bootstrap"
          },
          {
            name: "calcite-maps",
            location: "http://localhost/arcgis_js_api/library/4.11/dojo/Calcite-Maps/dist/js/dojo"
          }]
        };
      </script>
    
      <!-- ArcGIS JS 4 -->
      <script src="http://localhost/arcgis_js_api/library/4.11/dojo/dojo.js"></script>
    
      <script>
        
        require([
          // ArcGIS
          "esri/Map",
          "esri/views/MapView",
          "esri/layers/MapImageLayer",
          "esri/layers/FeatureLayer",
    
          // Widgets
          "esri/widgets/Home",
          "esri/widgets/Zoom",
          "esri/widgets/Compass",
          "esri/widgets/Search",
          "esri/widgets/Legend",
          "esri/widgets/BasemapToggle",
          "esri/widgets/CoordinateConversion",
          "esri/widgets/ScaleBar",
          "esri/widgets/Attribution",
    
          // Bootstrap
          "bootstrap/Collapse",
          "bootstrap/Dropdown",
    
          // Calcite Maps
          "calcite-maps/calcitemaps-v0.10",
          // Calcite Maps ArcGIS Support
          "calcite-maps/calcitemaps-arcgis-support-v0.10",
    
          // dojo
          "dijit/registry",
          "dojo/on",
          "dojo/dom",
          "dojo/domReady!"
          ], function(Map, MapView, MapImageLayer, FeatureLayer, Home, Zoom, Compass, Search, Legend, BasemapToggle, CoordinateConversion, ScaleBar, Attribution, Collapse, Dropdown, CalciteMaps, CalciteMapArcGISSupport, registry, on, dom) {
    
          /******************************************************************
           *
           * Create the map, view and widgets
           * 
           ******************************************************************/
    
           var map = new Map();
            
            // View
            var mapView = new MapView({
              container: "mapViewDiv",
              map: map,
              padding: {
                top: 50,
                bottom: 0
              },
              ui: {components: []}
            });
            
            var layer = null,
            layerUrl = "https://localhost:6443/arcgis/rest/services/SampleWorldCities/MapServer",
            layer = new MapImageLayer(layerUrl, null);
            map.layers.add(layer);

            var urls = {
              "cmb_ScannedMaps" : "https://localhost:6443/arcgis/rest/services/ScannedMaps/cmb_ScannedMaps/MapServer/3"
            };

            var template = {
                title: "Service Name: {Name}" ,
                //Fix for URLS in popup
                content: "URL: <a href=\"{URLs}\">{URLs}</a>"
            };

            var scannedMaps = new FeatureLayer({
                url:
                "https://localhost:6443/arcgis/rest/services/ScannedMaps/cmb_ScannedMaps/MapServer/1", 
                popupTemplate: template
            });

            var CIB = new FeatureLayer({
                url:
                "https://localhost:6443/arcgis/rest/services/Imagery/CIB_5/MapServer/1",
                popupTemplate: template
            });

            var dted1 = new FeatureLayer({
                url:
                "https://localhost:6443/arcgis/rest/services/Imagery/DTED_1/MapServer/1",
                popupTemplate: template
            });

            var dted2 = new FeatureLayer({
                url:
                "https://localhost:6443/arcgis/rest/services/Imagery/DTED_2/MapServer/1",
                popupTemplate: template
            });

            var imagery = new FeatureLayer({
                url:
                "https://localhost:6443/arcgis/rest/services/Imagery/cmb_Imagery/MapServer/1",
                popupTemplate: template
            });

            map.add(imagery);

            map.add(dted2);

            map.add(dted1);
            
            map.add(CIB);

            map.add(scannedMaps);
    
          // Popup and panel sync
          mapView.when(function(){
            CalciteMapArcGISSupport.setPopupPanelSync(mapView);
          });

          on(dom.byId("addSubmit"), "click", getValue);

          function getValue(){
            var layerURL = dojo.byId("serviceURL").value;
            var newLayer = new MapImageLayer({
              url: layerURL
            });
            map.add(newLayer);
            newLayer.when(function() {
              mapView.goTo(newLayer.fullExtent);
            });
          }
    
          // Search - add to navbar
          // var searchWidget = new Search({
          //   container: "searchWidgetDiv",
          //   view: mapView
          // });
          // CalciteMapArcGISSupport.setSearchExpandEvents(searchWidget);
    
          // Map widgets
          var home = new Home({
            view: mapView
          });
          mapView.ui.add(home, "bottom-left");
    
          var zoom = new Zoom({
            view: mapView
          });
          mapView.ui.add(zoom, "bottom-left");
    
          var compass = new Compass({
            view: mapView
          });
          mapView.ui.add(compass, "bottom-left");
          
          var basemapToggle = new BasemapToggle({
            view: mapView,
            secondBasemap: "satellite"
          });
          mapView.ui.add(basemapToggle, "bottom-right");          
          
          var scaleBar = new ScaleBar({
            view: mapView
          });
          mapView.ui.add(scaleBar, "bottom-right");
    
          var attribution = new Attribution({
            view: mapView
          });
          mapView.ui.add(attribution, "manual");
    
          // Panel widgets - add legend
          var legendWidget = new Legend({
            container: "legendDiv",
            view: mapView
          });

          var ccWidget = new CoordinateConversion({
            container: "coordconvDiv",
            view: mapView
          });
    
        });
      </script>
    
    </body>

{% endblock %}
